---
title: "Question2"
author: "Saeed Rahman"
date: "March 8, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### A)

Implement a trinomial tree to price European, American Call and Put op-
tions.

```{r}
library(quantmod)
library(rCharts)
library(reshape)

TrinomialTree = function(isCall, isAmerican=FALSE, K, Tm, 
                      S0, r, sig, N, div=0, dx=0,show=FALSE)
{
  # Precompute constants ----
  dt = Tm/N 
  nu = r - div - 0.5 * sig^2
  if(dx==0)
    dx=sig*sqrt(3*T/N)
  pu = 0.5 * ( (sig^2*dt + nu^2 *dt^2)/dx^2 + nu*dt/dx ) #up move probability
  pm = 1.0 -   (sig^2*dt + nu^2 *dt^2)/dx^2 #Side move probability
  pd = 0.5 * ( (sig^2*dt + nu^2 *dt^2)/dx^2 - nu*dt/dx ) # down move probability.
  #pu+pm+pd not necessarily equal to 1
  disc = exp(-r*dt) #Discount rate
  nRows = 2*N+1 #number of rows 
  nCols = N+1 #number of columns
  cp = ifelse(isCall, 1, -1) #to check if call or put
  # Intialize an empty matrix  ----
  V = S = matrix(0, nrow=nRows, ncol=nCols, dimnames=list(
    paste("NumUps", N:-N, sep="="), paste("T", 0:N, sep="=")))
  #Initial stock value
  S[nCols, 1] = S0
  #Fill in the stock matrix with the stock values over different states
  for (j in 1:N) {
    for(i in (nCols-j+1):(nCols+j-1)) {
      S[i-1, j+1] = S[i, j] * exp(dx)
      S[i ,  j+1] = S[i, j] 
      S[i+1, j+1] = S[i, j] * exp(-dx)
    }
  }
  # Intialize option values at maturity ----
  for (i in 1:nRows) {
    V[i, N+1] = max( 0, cp * (S[i, N+1]-K))
  }
  V
  # Step backwards through the tree ----
  for (j in (nCols-1):1) {
    for(i in (nCols-j+1):(nCols+j-1)) {
      #converging from N to N-1 state diagonally
      V[i, j] = disc * (pu*V[i-1,j+1] + pm*V[i, j+1] + pd*V[i+1,j+1])
      if(isAmerican) {
        V[i, j] = max(V[i, j], cp * (S[i, j] - K))
      }
    }
  }
  V
  # Return the value
  # list(Type = paste( ifelse(isAmerican, "American", "European"), 
  #                    ifelse(isCall, "Call", "Put")),
  #      Price = V[1,1], S=round(S,2), V=round(V,4))
  if(show){
    print("Stock Tree")
    print(S)
    print("Option Value Tree")
    print(V)
  }
  return(V[N+1,1])
}

TrinomialTree(isCall=T, isAmerican=F, K=100, T=1.0, div=0.03, S0=100, sig=0.2, r=0.06, N=5,show = TRUE)
print(paste("European Call Price=",TrinomialTree(isCall=T, isAmerican=F, K=100, T=1.0, div=0.03, S0=100, sig=0.2, r=0.06, N=200)))
print(paste("American Call Price=",TrinomialTree(isCall=T, isAmerican=T, K=100, T=1.0, div=0.03, S0=100, sig=0.2, r=0.06, N=200)))
print(paste("European Put Price=",TrinomialTree(isCall=F, isAmerican=F, K=100, T=1.0, div=0.03, S0=100, sig=0.2, r=0.06, N=200)))
print(paste("American Put Price=",TrinomialTree(isCall=F, isAmerican=T, K=100, T=1.0, div=0.03, S0=100, sig=0.2, r=0.06, N=200)))
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
